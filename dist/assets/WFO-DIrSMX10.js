import{a as J,f as K,r as c,j as e}from"./index-Dvb9ohnK.js";import{a as g}from"./Paper-DbN--PaP.js";import{S as Q,A as V}from"./Snackbar-B7uiJ5z9.js";import"./IconButton-BQi0Jw9M.js";function se(){const{userRole:h,userEmail:v}=J(),A=K(),[a,O]=c.useState(new Date),[u,$]=c.useState(30),[i,E]=c.useState(""),[x,F]=c.useState({Mon:!1,Tue:!1,Wed:!1,Thu:!1,Fri:!1}),[p,j]=c.useState({}),[S,w]=c.useState(0),[y,C]=c.useState(0),[b,k]=c.useState(0),[H,d]=c.useState(!1),[Y,m]=c.useState(""),[I,f]=c.useState("success");c.useEffect(()=>{g.get(`http://localhost:8000/users?email=${v}`).then(t=>{const n=t.data[0];n&&E(`${n.Name}(${n.EmpId})`)}).catch(t=>console.error("Error fetching user data:",t))},[v]),c.useEffect(()=>{W(a)},[a]),c.useEffect(()=>{i&&_()},[i,A]);const L=t=>{const n=new Date(t.target.value);O(n)},W=t=>{const n=t.getFullYear(),s=t.getMonth(),r=new Date(n,s+1,0).getDate();$(r)},P=t=>{F({...x,[t.target.name]:t.target.checked})},R=()=>{const t=Object.keys(x).filter(s=>x[s]),n={};for(let s=1;s<=u;s++){const r=new Date(a.getFullYear(),a.getMonth(),s),l=D(r);let o;t.includes(l)?o="O":N(r)?o="BH":o="H",n[s]=o}j(n),M(n)},M=t=>{let n=0,s=0,r=0;for(let l=1;l<=u;l++){const o=t[l];o==="O"?n++:o==="H"?s++:o==="L"&&!N(new Date(a.getFullYear(),a.getMonth(),l))&&r++}w(n),C(s),k(r)},U=t=>{j(n=>{const s={...n};return s[t]==="O"?s[t]="H":s[t]==="H"?s[t]="L":s[t]==="L"&&(s[t]="O"),M(s),s})},D=t=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t.getDay()],N=t=>{const n=t.getDay();return n===0||n===6},_=()=>{const t=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;g.get(`http://localhost:8000/employeeAttendances?name=${encodeURIComponent(i)}&month=${t}`).then(n=>{const s=n.data[0];if(s){const r=s.values.reduce((l,o)=>{const[q,z]=Object.entries(o)[0],G=new Date(q).getDate();return l[G]=z,l},{});j(r),w(s.TO),C(s.TH),k(s.TL)}}).catch(n=>console.error("Error fetching preferences:",n))},B=()=>{const t=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,n={month:t,name:i,values:Object.keys(p).map(s=>({[`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(s).padStart(2,"0")}`]:p[s]})),TO:S,TH:y,TL:b};g.get(`http://localhost:8000/employeeAttendances?name=${encodeURIComponent(i)}&month=${t}`).then(s=>{const r=s.data[0];r?g.put(`http://localhost:8000/employeeAttendances/${r.id}`,n).then(()=>{m(`Attendance updated successfully for ${i}`),f("success"),d(!0),console.log("Preferences updated successfully")}).catch(l=>{m("Error updating preferences"),f("error"),d(!0),console.error("Error updating preferences:",l)}):g.post("http://localhost:8000/employeeAttendances",n).then(()=>{m(`Attendance saved successfully for ${i}`),f("success"),d(!0),console.log("Preferences saved successfully")}).catch(l=>{m("Error saving preferences"),f("error"),d(!0),console.error("Error saving preferences:",l)})}).catch(s=>{m("Error fetching existing data"),f("error"),d(!0),console.error("Error fetching existing data:",s)})},T=()=>{d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-w-full overflow-hidden",children:e.jsxs("div",{className:"border-2 rounded-md bg-gray-50 py-4 m-8 flex flex-col justify-center items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-8 mb-4",children:[e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsx("label",{htmlFor:"monthSelector",className:"text-lg",children:"Forecast Month:"}),e.jsx("input",{type:"month",id:"monthSelector",name:"monthSelector",className:"border-spacing-4 border-2 border-gray-500 rounded-md p-1 text-lg",value:a.toISOString().slice(0,7),onChange:L})]}),h==="viewer"&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-lg",children:"WFO preferences:"}),["Mon","Tue","Wed","Thu","Fri"].map(t=>e.jsxs("label",{className:"text-lg",children:[e.jsx("input",{type:"checkbox",name:t,checked:x[t],onChange:P})," ",t]},t)),e.jsx("button",{onClick:R,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200",children:"Apply"}),e.jsx("button",{onClick:B,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200",children:"Save"})]})]}),e.jsx("div",{className:"flex justify-center w-full px-8",children:e.jsx("div",{className:"overflow-x-auto w-full bg-white",children:h==="admin"||h==="manager"?e.jsx("div",{className:"text-lg font-semibold m-4 text-center",children:"No data available"}):e.jsxs("table",{className:"min-w-max",children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{rowSpan:"2",className:"px-6",children:"Name"}),Array.from({length:u},(t,n)=>e.jsx("th",{children:n+1},n+1)),e.jsxs("th",{rowSpan:2,children:["TH (",y,")"]}),e.jsxs("th",{rowSpan:2,children:["TO (",S,")"]}),e.jsxs("th",{rowSpan:2,children:["TL (",b,")"]})]}),e.jsx("tr",{children:Array.from({length:u},(t,n)=>e.jsx("th",{children:D(new Date(a.getFullYear(),a.getMonth(),n+1))},n+1))})]}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6",children:i}),Array.from({length:u},(t,n)=>{const s=n+1,r=new Date(a.getFullYear(),a.getMonth(),s);return e.jsx("td",{onClick:()=>U(s),children:N(r)?e.jsx("button",{className:"weekend",children:"ðŸ˜Š"}):p[s]==="O"?e.jsx("button",{className:"O",children:"O"}):p[s]==="H"?e.jsx("button",{className:"H",children:"H"}):e.jsx("button",{className:"L",children:"L"})},s)}),e.jsx("td",{children:y}),e.jsx("td",{children:S}),e.jsx("td",{children:b})]})})]})})})]})}),e.jsx("div",{children:h==="viewer"?e.jsxs("div",{className:"ms-5 text-primary e-4 mt-2 fst-italic",style:{textAlign:"left"},children:[e.jsx("i",{className:"fa-solid fa-circle-info me-2",style:{color:"orange"}}),e.jsx("span",{className:"text-primary",children:"Click on a cell to change forecast of current and future dates"})]}):h!=="viewer"?e.jsxs("div",{children:[e.jsx("i",{className:"fa-solid fa-circle-info me-2 ms-4 mt-2",style:{color:"orange"}}),e.jsx("span",{className:"text-primary",children:"Click on a cell to change forecast"})]}):null}),e.jsx(Q,{open:H,autoHideDuration:6e3,onClose:T,children:e.jsx(V,{onClose:T,severity:I,sx:{width:"100%"},children:Y})})]})}export{se as default};
